"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var jwt=require("jsonwebtoken"),crypto_js_1=require("crypto-js"),JwtUtil=function(){function e(){this.cipher=function(t){function r(e){return e.split("").map(function(e){return e.charCodeAt(0)})}function n(e){return("0"+Number(e).toString(16)).substr(-2)}function i(e){return r(t).reduce(function(e,t){return e^t},e)}return function(e){return e.split("").map(r).map(i).map(n).join("")}},this.decipher=function(t){function r(e){return t.split("").map(function(e){return e.charCodeAt(0)}).reduce(function(e,t){return e^t},e)}return function(e){return e.match(/.{1,2}/g).map(function(e){return parseInt(e,16)}).map(r).map(function(e){return String.fromCharCode(e)}).join("")}}}return e.prototype.verifyPreauthToken=function(e,t,r){var n,i,o,u=require("../config");u.jwt.client.encryptionFlag?(i=new Date,o=new Date(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds()),n=i.getTime()+60*u.jwt.client.expireTime*1e3,i=o.getTime()+60*u.jwt.client.expireTime*1e3,o=crypto_js_1.enc.Hex.parse(e),o=crypto_js_1.AES.decrypt(o.toString(crypto_js_1.enc.Base64),u.jwt.client.id).toString(crypto_js_1.enc.Utf8),o=parseInt(o,10),(!isNaN(o)&&(o<n||o<i)?t:r)()):(e==u.jwt.client.id?t:r)()},e.prototype.verifyPostauthToken=function(e,r,n){var t=require("../config");e=this.fromBase64(e),jwt.verify(e,t.jwt.secret,function(e,t){e||(new Date).getTime()>t.time?n():r(t)})},e.prototype.generatePostauthToken=function(e,t){var r=require("../config"),t={userId:e,userType:t,time:(new Date).getTime()+60*r.jwt.authTokenInterval*1e3};return this.toBase64(jwt.sign(t,r.jwt.appSecret))},e.prototype.authenticateToken=function(e,r,n){var t=require("../config");jwt.verify(e,t.jwt.secret,function(e,t){e?n():r(t)})},e.prototype.generateAccessToken=function(e,t,r,n,i,o,u,c){var a=require("../config");new Date;return jwt.sign({id:e,package_id:t,customer_id:r,ext_number:n,token:"",user_type:u,app_type:c,api_access:o},a.jwt.secret)},e.prototype.toBase64=function(e){return Buffer.from(e).toString("base64")},e.prototype.fromBase64=function(e){return Buffer.from(e,"base64").toString("ascii")},e}();module.exports=JwtUtil;