"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PushEmail=void 0;var table_1=require("../dba/table"),path=require("path"),nodemailer=require("nodemailer"),knex=require("../dba/knex.db"),config=require("../config"),EmailTemplate=require("email-templates"),PushEmail=function(){function e(){this.transporter=nodemailer.createTransport({host:config.mailing.host,port:465,secure:!0,service:"gmail",auth:{user:config.mailing.user,pass:config.mailing.pass}})}return e.prototype.getCustomerNameandEmail=function(e){return knex.raw("select CONCAT(first_name, ' ',last_name) as name,company_name,email      from "+table_1.Table.tbl_Customer+"    where id in ("+e+")").then(function(e){if(e)return{userName:e[0][0].name,email:e[0][0].email,company_name:e[0][0].company_name}})},e.prototype.getExtensionName=function(a){return knex(table_1.Table.tbl_Extension_Master).where("email","=",""+a).select("username as name").then(function(e){if(e)return{userName:e[0].name,email:a}})},e.prototype.getEmailContentUsingCategory=function(e){return knex.select("e.id","e.name","e.title","e.image","e.content","e.email_category_id","c.category_name as category_name").from(table_1.Table.tbl_Email_template+" as e").leftOuterJoin(table_1.Table.tbl_Email_Category+" as c","e.email_category_id","c.id").where("c.category_name","=",""+e).andWhere("e.status","=","1").then(function(e){return e[0]})},e.prototype.getCustomerName=function(a){return knex(table_1.Table.tbl_Customer).where("email","=",""+a).andWhere("status","=","1").select(knex.raw("CONCAT(first_name, ' ',last_name) as name")).then(function(e){return{userName:e[0].name,email:a}})},e.prototype.getCustomerEmail=function(a){return knex.select("id","email").from(table_1.Table.tbl_Customer).where("first_name","=",""+a).andWhere("status","=","1").then(function(e){return{userName:a,email:e[0].email}})},e.prototype.sendmail=function(e){console.log("data=====",e.data);var a=path.join(__dirname,"../","emailTemplate","testMailTemplate");console.log(a);a=new EmailTemplate(a),e.mailList,e.action,e.data.email,e.action,e.data.userName,e.val.title,e.val.content,e.val.image,e.val.email_category_id,e.ticket_number,e.ticket_type_name,e.product,e.ticketMessage,e.reply,e.username,e.password,e.feature,e.customer,e.data.url,e.data.invoice_number,e.data.amount,e.data.fare_amount,e.data.gst_amount,e.data.invoice_month,e.data.didDatas,e.data.userName,e.data.email,e.data.company_name,e.data.countryName,e.boosterData,e.data.customerEmail;return console.log("testMailTemplate=====",a),this.transporter.sendMail({from:"helpdesk@cloud-connect.in",to:e.data.email,subject:e.val.title,text:e.val.content,html:"<strong>Hello world?</strong>"})},e}();exports.PushEmail=PushEmail;