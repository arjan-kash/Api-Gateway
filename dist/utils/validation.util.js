"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Validation=void 0;var table_1=require("../dba/table"),knex=require("../dba/knex.db"),Validation=function(){function e(){}return e.prototype.validateEmail=function(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},e.prototype.validateMobile=function(e){return/^([0|\+[0-9]{1,5})?([7-9][0-9]{9})$/.test(String(e).toLowerCase())},e.prototype.validateOnlyChar=function(e){return/^[a-zA-Z]+$/g.test(String(e).toLowerCase())},e.prototype.validateOnlyNumber=function(e){return/^[0-9]*$/.test(String(e).toLowerCase())},e.prototype.secure_password_generator=function(e){for(var t=e||8,n="abcdefghijklmnopqrstuvwxyz",r="ABCDEFGHIJKLMNOPQRSTUVWXYZ",o="0123456789",a="!#$%&*+,-./:<=>?@[]^_{|}~",l="",i="";l.length<t;){var c=Math.ceil(n.length*Math.random()*Math.random()),u=Math.ceil(o.length*Math.random()*Math.random()),d=Math.ceil(a.length*Math.random()*Math.random()),h=Math.ceil(r.length*Math.random()*Math.random());i+=n.charAt(c),i+=r.charAt(h),i+=o.charAt(u),l=i+=a.charAt(d)}return(l=l.split("").sort(function(){return.5-Math.random()}).join("")).substr(0,e)},e.prototype.sipPassword=function(){for(var e="0123456789abcdefghijklmnopqrstuvwxyz",t="",n=0,r=e.length;n<8;++n)t+=e.charAt(Math.floor(Math.random()*r));return t},e.prototype.validateAccountManager=function(e){return knex.select(knex.raw("COUNT(c.id) as count")).from(table_1.Table.tbl_Customer+" as c").andWhere("c.id",e).andWhere("c.role_id","4").then(function(e){return 0<e[0].count})},e.prototype.validateDialOut=function(e){return knex.select("dg.id").from(table_1.Table.tbl_Dialout_Group+" as dg").where("dg.id",e).then(function(e){return""!=e&&e[0].id})},e.prototype.validateExtension=function(e,t){return knex.from(table_1.Table.tbl_Extension_Master).where("customer_id",""+t).andWhere("ext_number",""+e).select("id").then(function(e){return 1<=e.length})},e.prototype.validateEmailExist=function(e){return knex.from(table_1.Table.tbl_Extension_Master).where("email",""+e).select("id").then(function(e){return 0<e.length}).catch(function(e){console.log(e)})},e.prototype.validateCustomerEmailExist=function(e){return knex.from(table_1.Table.tbl_Customer).where("email",""+e).andWhere("status","!=","2").andWhere("role_id","!=","0").select("id").then(function(e){return 0<e.length}).catch(function(e){console.log(e)})},e.prototype.validateExtensionLimit=function(t,e){return knex.from(table_1.Table.tbl_Extension_Master).where("customer_id",""+e).andWhere("status","1").select("*").then(function(e){return 0==parseInt(t)-parseInt(e.length||0)})},e.prototype.validateExtensionLength=function(e){return knex.from(table_1.Table.tbl_Customer).where("id",""+e).select("extension_length_limit").then(function(e){return e[0]}).catch(function(e){console.log(e)})},e.prototype.validateCountry=function(e){return knex.from(table_1.Table.tbl_Country).where("id",""+e).select("phonecode").then(function(e){return e[0]}).catch(function(e){console.log(e)})},e.prototype.validateState=function(e){return knex.from(table_1.Table.tbl_States).where("id",""+e).select("id").then(function(e,t){if(0<e.length)return e[0]}).catch(function(e){console.log(e)})},e.prototype.validateCustomerCompany=function(e){return knex.from(table_1.Table.tbl_Customer).where("company_name",""+e).andWhere("status","!=","2").andWhere("role_id","=","1").select("id").then(function(e){return 0<e.length}).catch(function(e){console.log(e)})},e.prototype.validatePackage=function(e){return knex.from(table_1.Table.tbl_Package).where("id",e).select("mapped").then(function(e){return"1"==e[0].mapped}).catch(function(e){console.log(e)})},e.prototype.validatePackageBasedOnCircle=function(e,t){return knex.from(table_1.Table.tbl_Package+" as p").leftJoin(table_1.Table.tbl_Features+" as f","f.id","p.feature_id").where("p.id",e).andWhere("f.circle_id",t).select("p.id").then(function(e){return console.log(e),!e.length}).catch(function(e){console.log(e)})},e.prototype.validateCircleExist=function(e){return knex.from(table_1.Table.tbl_circle).where("id",e).select("id").then(function(e){return!(0<e.length)}).catch(function(e){console.log(e)})},e.prototype.validatePackageExist=function(e){return knex.from(table_1.Table.tbl_Package).where("id",e).select("id").then(function(e){return!(0<e.length)}).catch(function(e){console.log(e)})},e.prototype.validateProviderExist=function(e){return knex.from(table_1.Table.tbl_Provider).where("provider",""+e).select("id").then(function(e){return 0!=e&&e[0].id}).catch(function(e){console.log(e)})},e.prototype.validateFeature=function(e){return knex.from(table_1.Table.tbl_Feature_Plan).where("id",""+e).select("id").then(function(e){return 0<e.length&&e[0]}).catch(function(e){console.log(e)})},e.prototype.ValidateSmsExist=function(e){return knex.from(table_1.Table.tbl_SMS).where("id",""+e).select("id").then(function(e){return 0<e.length&&e[0]}).catch(function(e){console.log(e)})},e.prototype.validateCallPlanExist=function(e){return knex(table_1.Table.tbl_Call_Plan).where("is_minute_plan","like","0").andWhere("id",e).select("id").then(function(e){return e})},e.prototype.validateBundle=function(e){return knex.raw("call pbx_getMinutePlanForPackageCretion("+e+")").then(function(e){return!!e&&e[0][0]})},e.prototype.validateCallPlanBasedOnCircle=function(e,t){return knex(table_1.Table.tbl_Call_Plan).where("is_minute_plan","like","0").andWhere("id",e).andWhere("circle_id",t).select("id").then(function(e){return 0<e.length})},e.prototype.validateCircle=function(e){return knex(table_1.Table.tbl_circle).where("id",e).select("id").then(function(e){return 0<e.length&&e[0].id}).catch(function(e){return e})},e.prototype.validateCountryExist=function(e){return knex(table_1.Table.tbl_Country).where("id",e).select("id").then(function(e){return 0<e.length&&e})},e.prototype.validateDID=function(e){return knex(table_1.Table.tbl_DID).where("did",e).select("did").then(function(e){return""==e||e})},e.prototype.GetCustomerByProduct=function(e,t){return knex.from(table_1.Table.tbl_Customer+" as c").leftJoin(table_1.Table.tbl_Map_Customer_Package+" as mcp","mcp.customer_id","c.id").where("c.status","1").andWhere("c.role_id","1").andWhere("mcp.product_id",e).andWhere("c.id",t).select("c.id","c.balance").then(function(e){return""!=e&&e}).catch(function(e){console.log(e)})},e.prototype.GetDIDByCountry=function(e,t){return knex(table_1.Table.tbl_DID).where("country_id",e).andWhere("reserved",1).andWhere("status","1").andWhere("did",t).select("did").then(function(e){return""!=e&&e})},e.prototype.validateCodec=function(e){return knex(table_1.Table.tbl_Codec).where("id",e).select("name").then(function(e){return""!=e&&e[0].name})},e.prototype.validateCallPlanName=function(e){return knex(table_1.Table.tbl_Call_Plan).where("name",e).select("name").then(function(e){return""==e})},e.prototype.validatePlanType=function(e,t){return knex(table_1.Table.tbl_Call_Plan).where("plan_type",e).andWhere("id",t).select("id").then(function(e){return""!=e&&e[0].id})},e.prototype.getCountry=function(e){return knex(table_1.Table.tbl_Country).where("id",e).select("phonecode").then(function(e){return""!=e&&e[0].phonecode})},e.prototype.validateGroup=function(e){return knex(table_1.Table.tbl_Call_Rate_Group).where("id",e).select("minutes").then(function(e){return""!=e&&e[0].minutes})},e.prototype.validateGateway=function(e){return knex(table_1.Table.tbl_Gateway).where("id",e).select("id").then(function(e){return""!=e&&e[0].id})},e}();exports.Validation=Validation;