"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var express=require("express"),path=require("path"),morgan=require("morgan"),fileUpload=require("express-fileupload"),logger_util_1=require("./utils/logger.util"),bodyParser=require("body-parser"),api_logs_1=require("./utils/api-logs"),app=express(),config=require("./config");app.set("config",config),app.engine("html",require("ejs").renderFile),app.set("view engine","html"),app.set("view engine","ejs"),config.production?(console.log=function(e){return logger_util_1.traceLog(e)},console.debug=function(e){return logger_util_1.debugLog(e)},app.use(morgan("common",{stream:{write:function(e){logger_util_1.traceLog(e)}}}))):app.use(morgan("dev")),app.use(bodyParser.urlencoded({limit:"50mb",extended:!0,parameterLimit:5e4})),app.use(express.json({type:"application/json"})),app.use(express.urlencoded({extended:!0})),app.use(express.static(path.join(__dirname,"public"),{index:!1})),app.use(fileUpload()),app.use(function(e,r,o){config.production||(r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS, PUT, PATCH, DELETE"),r.setHeader("Access-Control-Allow-Headers","X-Requested-With,content-type,Cache-Control,x-auth-token,x-access-token"),r.setHeader("Access-Control-Allow-Credentials","true")),o()}),app.use("/",require("./routes/public-api.routes")),app.use("/api-gateway",require("./routes/secured-api.routes")),app.use("/upload",require("./routes/upload.routes")),app.disable("x-powered-by"),app.use(function(e,r,o){var s=new Error("404: Not Found");s.status=404,o(s)}),app.use(function(e,r,o,s){new api_logs_1.ApiLogs;var t=e.message||"Internal Server Error";logger_util_1.errorLog(t),e.status&&404==e.status?logger_util_1.errorLog("404 - "+r.url):logger_util_1.errorLog(e),o.json({status_codes:e.status||500,message:t+r.url})}),logger_util_1.infoLog("Server init is done"),module.exports=app;