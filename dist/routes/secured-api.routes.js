"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var express=require("express"),multer=require("multer"),cdr_service_1=require("../services/cdr.service"),extension_service_1=require("../services/extension.service"),recording_service_1=require("../services/recording.service"),logger_util_1=require("../utils/logger.util"),api_logs_1=require("../utils/api-logs"),circle_service_1=require("../services/circle.service"),minutePlan_1=require("../services/minutePlan"),sms_service_1=require("../services/sms.service"),package_service_1=require("../services/package.service"),customer_service_1=require("../services/customer.service"),did_service_1=require("../services/did.service"),ROUTER=express.Router({mergeParams:!0});ROUTER.use("*",function(a,e,t){if(console.log(a.headers),"OPTIONS"==a.method)t();else{var s=new(require("../utils/jwt.util")),r=new api_logs_1.ApiLogs;if(!a.headers["x-access-token"])return logger_util_1.unauthLog("x-access-token",a.originalUrl,a.ip,a.headers),e.json({status_code:402,message:"Unauthenticated User - Token is missing"}),void r.log(402,"Unauthenticated User - Token is missing.",a.originalUrl,"","","");s.authenticateToken(a.headers["x-access-token"],function(e){a.id=e.id,a.package_id=e.package_id,a.customer_id=e.customer_id,a.ext_number=e.ext_number,a.user_type=e.user_type,a.app_type=e.app_type,t()},function(){logger_util_1.unauthLog("x-access-token-invalid",a.originalUrl,a.ip,a.headers),r.log(401,"Unauthorize User - Token is invalid.",a.originalUrl,"","",""),e.json({status_code:401,message:"Unauthorized User - Token is invalid"})})}}),ROUTER.get("/extension/:opt",function(e,a,t){e.headers.type=e.app_type;var s=new extension_service_1.ExtensionService;"pbx"==e.headers.type?"all"==e.params.opt||("contacts"==e.params.opt?s.getAllExtesnionContacts(e,a,t):"sip"==e.params.opt?s.getAllUserExtensions(e,a,t):"did-mapping"==e.params.opt?s.getExtensionsDIDmapping(e,a,t):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptables"}))):"sp"==e.headers.type?"contacts"==e.params.opt?s.getAllExtesnionContacts(e,a,t):"sip"==e.params.opt?s.getAllUserExtensions(e,a,t):"did-mapping"==e.params.opt?s.getExtensionsDIDmapping(e,a,t):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"})):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/profile",function(e,a,t){var s=new extension_service_1.ExtensionService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getExtesnionProfie(e,a,t):"sp"==e.headers.type?s.getExtesnionProfieForSP(e,a,t):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/circle",function(e,a,t){var s=new circle_service_1.CircleService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getCircle(e,a,t,"pbx"):"sp"==e.headers.type?s.getCircle(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/sms-plan",function(e,a,t){var s=new sms_service_1.SMSService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getSMS(e,a,t,"pbx"):"sp"==e.headers.type?s.getSMS(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/dialout-rates",function(e,a,t){var s=new circle_service_1.CircleService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getDialOutRates(e,a,t,"pbx"):"sp"==e.headers.type?s.getDialOutRates(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/package",function(e,a,t){var s=new package_service_1.PackageService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getPackage(e,a,t,"pbx"):"sp"==e.headers.type?s.getPackage(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/did",function(e,a,t){var s=new did_service_1.DIDService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getDID(e,a,t,"pbx"):"sp"==e.headers.type||(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/did-release",function(e,a,t){var s=new did_service_1.DIDService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.didRelease(e,a,t,"pbx"):"sp"==e.headers.type||(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/customer",function(e,a,t){console.log(e.query.type),e.headers.type=e.app_type;var s=new customer_service_1.CustomerService;"pbx"==e.headers.type?s.getCustomers(e,a,t,"pbx"):"sp"==e.headers.type?s.getCustomers(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/country",function(e,a,t){console.log(e.query.type);var s=new circle_service_1.CircleService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getCountries(e,a,t,"pbx"):"sp"==e.headers.type?s.getCountries(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/timezone",function(e,a,t){console.log(e.query.type);var s=new circle_service_1.CircleService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getTimeZone(e,a,t,"pbx"):"sp"==e.headers.type?s.getTimeZone(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/billingType",function(e,a,t){var s=new circle_service_1.CircleService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getBillingType(e,a,t,"pbx"):"sp"==e.headers.type?s.getBillingType(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/state",function(e,a,t){console.log(e.query.type);var s=new circle_service_1.CircleService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getStates(e,a,t,"pbx"):"sp"==e.headers.type?s.getStates(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/callPlan",function(e,a,t){console.log(e.query.type);var s=new minutePlan_1.MinutePlanService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getCallPlan(e,a,t,"pbx"):"sp"==e.headers.type?s.getCallPlan(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/dialoutGroup",function(e,a,t){console.log(e.query.type);var s=new circle_service_1.CircleService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getDialOutGroup(e,a,t,"pbx"):"sp"==e.headers.type?s.getDialOutGroup(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/callPlanRate",function(e,a,t){console.log(e.query.type);var s=new minutePlan_1.MinutePlanService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getCallPlanRates(e,a,t,"pbx"):"sp"==e.headers.type?s.getCallPlanRates(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/packageType",function(e,a,t){var s=new circle_service_1.CircleService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getPackageType(e,a,t,"pbx"):"sp"==e.headers.type?s.getPackageType(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/productType",function(e,a,t){var s=new circle_service_1.CircleService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getProductType(e,a,t,"pbx"):"sp"==e.headers.type?s.getProductType(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/provider",function(e,a,t){var s=new circle_service_1.CircleService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getProvider(e,a,t,"pbx"):"sp"==e.headers.type?s.getProvider(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.get("/gateway",function(e,a,t){var s=new circle_service_1.CircleService;e.headers.type=e.app_type,"pbx"==e.headers.type?s.getGateway(e,a,t,"pbx"):"crm"==e.headers.type&&s.getGateway(e,a,t,"crm")}),ROUTER.post("/extension/:opt/:id",function(e,a,t){var s=new extension_service_1.ExtensionService;"location"==e.params.opt?s.saveExtesnionLocation(e,a,t):(logger_util_1.warnLog("Invalid parameters."),a.json({message:"OptIn yydghf."}))}),ROUTER.post("/extension/:opt",function(e,a,t){console.log(e.params.opt,"req.params.opt");var s=new api_logs_1.ApiLogs,r=new extension_service_1.ExtensionService,p=new recording_service_1.RecordingService;e.headers.type=e.app_type,"sip"==e.params.opt?r.getIndividualExtesnionInfo(e,a,t):"recording"!=e.params.opt||e.body.hasOwnProperty("user_type")||"crm"!=e.headers.type?"recording"!=e.params.opt||e.body.hasOwnProperty("user_type")?"recording"==e.params.opt?p.getCustomerRecording(e,a,t):"voicemail-recording"==e.params.opt?p.getExtensionVoicemailRecording(e,a,t):"c2c"==e.params.opt&&"crm"==e.headers.type?r.getCRMExtensionCall2Call(e,a,t):"c2c"==e.params.opt?r.getExtensionCall2Call(e,a,t):"add"==e.params.opt?r.extensionCreation(e,a,t):"features-update"==e.params.opt?r.updateExtensionFeatures(e,a,t):(logger_util_1.warnLog("Invalid parameters."),s.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"","",""),a.json({status_code:406,message:"Not Acceptable : Invalid parameters"})):p.getExtensionRecording(e,a,t):p.getCRMRecording(e,a,t)}),ROUTER.post("/extensions/favorite/:opt",function(e,a,t){var s=new extension_service_1.ExtensionService;"add"==e.params.opt?s.makeExtensionContactAsFavorite(e,a,t):"delete"==e.params.opt?s.makeExtensionContactAsUnFavorite(e,a,t):"all"==e.params.opt||""==e.params.opt?s.getAllFavoriteExtesnionContact(e,a,t):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.post("/extensions/:opt1/:opt2",function(e,a,t){console.log(e.params.opt1,"req.params.opt"),console.log(e.params.opt2,"req.params.opt2");var s=new extension_service_1.ExtensionService;"c2c"==e.params.opt1&&"update"==e.params.opt2&&"crm"==e.headers.type?s.getCRMC2Cstatus(e,a,t):"c2c"==e.params.opt1&&"update"==e.params.opt2?s.getC2Cstatus(e,a,t):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.post("/minutePlan/:opt",function(e,a,t){var s=new api_logs_1.ApiLogs,r=new minutePlan_1.MinutePlanService;"list"==e.params.opt?r.getMinutePlanForAdmin(e,a,t):(logger_util_1.warnLog("Invalid parameters."),s.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"","",""),a.json({status_code:406,message:"Not Acceptable : Invalid parameters"}))}),ROUTER.post("/callPlan/:opt",function(e,a,t){var s=new api_logs_1.ApiLogs,r=new minutePlan_1.MinutePlanService;"add"==e.params.opt?r.callPlanCreation(e,a,t):(logger_util_1.warnLog("Invalid parameters."),s.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"","",""),a.json({status_code:406,message:"Not Acceptable : Invalid parameters"}))}),ROUTER.post("/provider/:opt",function(e,a,t){var s=new api_logs_1.ApiLogs,r=new minutePlan_1.MinutePlanService;"add"==e.params.opt?r.providerCreation(e,a,t):(logger_util_1.warnLog("Invalid parameters."),s.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"","",""),a.json({status_code:406,message:"Not Acceptable : Invalid parameters"}))}),ROUTER.post("/customer/:opt",function(e,a,t){var s=new api_logs_1.ApiLogs,r=new customer_service_1.CustomerService;"add"==e.params.opt?r.customerCreation(e,a,t):"purchase-did"==e.params.opt?r.didPurchase(e,a,t,"pbx"):(logger_util_1.warnLog("Invalid parameters."),s.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"","",""),a.json({status_code:406,message:"Not Acceptable : Invalid parameters"}))}),ROUTER.post("/package/:opt",function(e,a,t){var s=new api_logs_1.ApiLogs,r=new package_service_1.PackageService;"add"==e.params.opt?r.PackageCreation(e,a,t):(logger_util_1.warnLog("Invalid parameters."),s.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"","",""),a.json({status_code:406,message:"Not Acceptable : Invalid parameters"}))}),ROUTER.put("/:opt/update",function(e,a,t){var s=new extension_service_1.ExtensionService;e.headers.type=e.app_type;var r=new api_logs_1.ApiLogs;"pbx"==e.headers.type?"profile"==e.params.opt?s.updateExtensionProfile(e,a,t,"pbx"):(logger_util_1.warnLog("Invalid parameters."),r.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"","",""),a.json({status_code:406,message:"Not Acceptable"})):"sp"==e.headers.type?"profile"==e.params.opt?s.updateExtensionProfile(e,a,t,"sp"):(logger_util_1.warnLog("Invalid parameters."),r.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"","",""),a.json({status_code:406,message:"Not Acceptable."})):(logger_util_1.warnLog("Invalid parameters."),r.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"","",""),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.patch("/cdr",function(e,a,t){var s=new cdr_service_1.CDRService,r=new api_logs_1.ApiLogs;e.headers.type=e.app_type,e.body.type=e.user_type,"pbx"==e.headers.type?("6"==e.body.type&&s.getExtensionCDR(e,a,t),"1"==e.body.type?s.getCustomerCDR(e,a,t):"0"==e.body.type&&s.getAdminCDR(e,a,t)):"sp"==e.headers.type?(r.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"","",""),a.json({status_code:406,message:"Type Not Acceptable"})):"crm"==e.headers.type?"6"==e.body.type?s.getCRMCDR(e,a,t):"1"==e.body.type?s.getCustomerCDR(e,a,t):"0"==e.body.type&&s.getAdminCDR(e,a,t):(logger_util_1.warnLog("Invalid parameters."),r.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"","",""),a.json({status_code:406,message:"Type Not Acceptable"}))}),ROUTER.put("/:opt/updates",function(e,a,t){var s=new customer_service_1.CustomerService,r=new api_logs_1.ApiLogs;e.headers.type=e.app_type,"customer"==e.params.opt?s.UpdateCustomerDetail(e,a,t):(logger_util_1.warnLog("Invalid parameters."),r.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"",""),a.json({status_code:406,message:"Not Acceptable."}))}),ROUTER.patch("/:opt/update",function(e,a,t){var s=new package_service_1.PackageService,r=new api_logs_1.ApiLogs;e.headers.type=e.app_type,"package"==e.params.opt?s.packageUpdate(e,a,t):(logger_util_1.warnLog("Invalid parameters."),r.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"",""),a.json({status_code:406,message:"Not Acceptable."}))}),ROUTER.get("/provider",function(e,a,t){var s=new minutePlan_1.MinutePlanService;e.headers.type=e.app_type,"pbx"==e.headers.type||"crm"==e.headers.type?s.getProvider(e,a,t):(logger_util_1.warnLog("Invalid parameters."),a.json({status_code:406,message:"Not Acceptable"}))}),ROUTER.patch("/assign/:opt",function(e,a,t){var s=new did_service_1.DIDService,r=new api_logs_1.ApiLogs;"did"==e.params.opt?s.didAssign(e,a,t):(logger_util_1.warnLog("Invalid parameters."),r.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"",""),a.json({status_code:406,message:"Not Acceptable."}))}),ROUTER.post("/gateway/:opt",function(e,a,t){var s=new circle_service_1.CircleService,r=new api_logs_1.ApiLogs;e.headers.type=e.app_type,"pbx"==e.headers.type&&"add"==e.params.opt?s.createGateway(e,a,t):(logger_util_1.warnLog("Invalid parameters."),r.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"",""),a.json({status_code:406,message:"Not Acceptable."}))}),ROUTER.post("/did/:opt",function(e,a,t){var s=new did_service_1.DIDService,r=new api_logs_1.ApiLogs;e.headers.type=e.app_type,"pbx"==e.headers.type&&"add"==e.params.opt?s.createDID(e,a,t):(logger_util_1.warnLog("Invalid parameters."),r.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"",""),a.json({status_code:406,message:"Not Acceptable."}))}),ROUTER.post("/callPlanRate/:opt",function(e,a,t){var s=new minutePlan_1.MinutePlanService,r=new api_logs_1.ApiLogs;"add"==e.params.opt?s.CreateCallRate(e,a,t):(logger_util_1.warnLog("Invalid parameters."),r.log(406,"Not Acceptable : Invalid parameters",e.originalUrl,"",""),a.json({status_code:406,message:"Not Acceptable."}))}),module.exports=ROUTER;